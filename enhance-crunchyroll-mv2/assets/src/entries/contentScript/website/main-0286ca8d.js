import{M as p,g as _}from"../../../../render-81cea469.js";import{a as j,J,c as V,S as y,W as B}from"../../../../settings-ec2c2194.js";import{S as C,i as I,a as H,E as K,d as g,n as k,g as v,e as w,t as b,l as d,f as m,o as D,b as Z,c as r,R as u}from"../../../../index-16b32d61.js";async function T(a){return await j(J,{url:"https://graphql.anilist.co",init:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a})}})}function z(a){let t,e,n,i=Intl.DateTimeFormat("en-GB",{day:"2-digit",weekday:"long",month:"2-digit"}).format(a[0])+"",s,l,o=Intl.DateTimeFormat("en-US",{minute:"2-digit",hour:"2-digit"}).format(a[0])+"",c;return{c(){t=w("div"),e=w("p"),n=b("Next episode airs on "),s=b(i),l=b(" at "),c=b(o),d(e,"text-decoration","underline #f47521"),d(t,"margin","-1rem 0 1.625rem")},m(f,h){g(f,t,h),m(t,e),m(e,n),m(e,s),m(e,l),m(e,c)},p(f,h){h&1&&i!==(i=Intl.DateTimeFormat("en-GB",{day:"2-digit",weekday:"long",month:"2-digit"}).format(f[0])+"")&&D(s,i),h&1&&o!==(o=Intl.DateTimeFormat("en-US",{minute:"2-digit",hour:"2-digit"}).format(f[0])+"")&&D(c,o)},d(f){f&&v(t)}}}function Q(a){let t,e=a[0]&&z(a);return{c(){e&&e.c(),t=K()},m(n,i){e&&e.m(n,i),g(n,t,i)},p(n,[i]){n[0]?e?e.p(n,i):(e=z(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:k,o:k,d(n){n&&v(t),e&&e.d(n)}}}function X(a,t,e){let n=null;return(async()=>{var i,s;const l=`
		query {
			Media(search: "${document.location.pathname.split("/").slice(-1)[0]}", type: ANIME, status: RELEASING) {
				nextAiringEpisode {
				airingAt
				}
			}
		}
		`,o=await T(l);!((s=(i=o.data.Media)===null||i===void 0?void 0:i.nextAiringEpisode)===null||s===void 0)&&s.airingAt&&e(0,n=new Date(o.data.Media.nextAiringEpisode.airingAt*1e3))})(),[n]}class R extends C{constructor(t){super(),I(this,t,X,Q,H,{})}}function O(a){let t,e,n,i,s,l;return{c(){t=w("a"),e=u("svg"),n=u("path"),i=u("path"),s=u("path"),r(n,"fill","#1e2630"),r(n,"d","M0 0h1024v1024H0"),d(n,"stroke-width","2"),r(i,"fill","#02a9ff"),r(i,"d","M643.84 646.54V273.199c0-21.395-11.773-33.203-33.116-33.203h-72.865c-21.344 0-33.123 11.808-33.123 33.203v177.303c0 4.993 47.992 28.178 49.245 33.082 36.565 143.219 7.945 257.84-26.717 263.2 56.675 2.81 62.91 30.128 20.696 11.462 6.458-76.418 31.656-76.269 104.098-2.812.62.634 14.854 30.564 15.74 30.564h171.09c21.344 0 33.116-11.8 33.116-33.2v-73.048c0-21.396-11.772-33.203-33.116-33.203z"),d(i,"stroke-width","2"),r(s,"fill","#fefefe"),r(s,"d","M341.36 240 149.999 786h148.676l32.384-94.444h161.92L524.63 786h147.936L481.938 240Zm23.553 330.56 46.365-151.258 50.785 151.258z"),d(s,"stroke-width","2"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"width","20"),r(e,"height","20"),r(e,"viewBox","0 0 1024 1024"),r(e,"class","svelte-tb9k6w"),r(t,"href",l="https://anilist.co/anime/"+a[2]),r(t,"target","_blank"),r(t,"class","svelte-tb9k6w")},m(o,c){g(o,t,c),m(t,e),m(e,n),m(e,i),m(e,s)},p(o,c){c&4&&l!==(l="https://anilist.co/anime/"+o[2])&&r(t,"href",l)},d(o){o&&v(t)}}}function P(a){let t,e,n,i,s;return{c(){t=w("a"),e=u("svg"),n=u("path"),i=u("path"),r(n,"d","M0 0h1024v1024H0Z"),d(n,"fill","#2e51a2"),d(n,"stroke-width",".99968"),r(i,"d","M387.56 353.284v281.231l-70.21-.094v-174.1l-67.784 80.273-66.407-82.073-.673 176.464h-71.149V353.347h73.56l62.274 84.969 67.3-85zm288.07 69.083.83 211.522H597.5l-.265-95.862h-93.483c2.332 16.669 7.012 42.258 13.93 59.474 5.18 12.724 9.953 25.041 19.469 37.656l-56.922 37.562c-11.66-21.238-20.769-44.636-29.314-69.521a310.373 310.373 0 0 1-16.935-72.761c-2.833-25.042-3.24-49.113 3.569-73.857a130.481 130.481 0 0 1 38.767-62.306c10.455-9.782 25.041-16.7 36.733-22.944 11.69-6.245 24.806-8.812 36.967-11.989a247.284 247.284 0 0 1 39.769-6.104c13.287-1.142 36.967-2.206 79.82-.939l18.201 58.394H595.81c-19.798.266-29.314 0-44.777 6.98a74.655 74.655 0 0 0-42.664 64.169l88.913 1.095 1.267-60.428h77.097zm133.299-70.037v221.225l103.734 1.017-14.352 59.27h-160.5V351.281Z"),d(i,"fill","#fff"),d(i,"stroke-width","1.56459"),d(i,"stroke-dasharray","none"),r(e,"width","20"),r(e,"height","20"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"viewBox","0 0 1024 1024"),r(e,"class","svelte-tb9k6w"),r(t,"href",s="https://myanimelist.net/anime/"+a[3]),r(t,"target","_blank"),r(t,"class","svelte-tb9k6w")},m(l,o){g(l,t,o),m(t,e),m(e,n),m(e,i)},p(l,o){o&8&&s!==(s="https://myanimelist.net/anime/"+l[3])&&r(t,"href",s)},d(l){l&&v(t)}}}function Y(a){let t,e,n=a[0]&&a[2]&&O(a),i=a[1]&&a[3]&&P(a);return{c(){t=w("div"),n&&n.c(),e=Z(),i&&i.c(),r(t,"class","svelte-tb9k6w")},m(s,l){g(s,t,l),n&&n.m(t,null),m(t,e),i&&i.m(t,null)},p(s,[l]){s[0]&&s[2]?n?n.p(s,l):(n=O(s),n.c(),n.m(t,e)):n&&(n.d(1),n=null),s[1]&&s[3]?i?i.p(s,l):(i=P(s),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:k,o:k,d(s){s&&v(t),n&&n.d(),i&&i.d()}}}function $(a,t,e){let{seasonName:n}=t,{anilist:i}=t,{mal:s}=t,l,o;return(async()=>{const c=`
		query {
			Media(search: "${n}", type: ANIME) {
				id
				idMal
			}
		}
		`,f=await T(c);e(2,l=f.data.Media.id),e(3,o=f.data.Media.idMal)})(),a.$$set=c=>{"seasonName"in c&&e(4,n=c.seasonName),"anilist"in c&&e(0,i=c.anilist),"mal"in c&&e(1,s=c.mal)},[i,s,l,o,n]}let M=class extends C{constructor(t){super(),I(this,t,$,Y,H,{seasonName:4,anilist:0,mal:1})}};const q={seriesRatingContainer:async()=>await _(a=>a.querySelector(".action-buttons"),document.getElementById("content"),!0),seasonWithNavigationContainer:async()=>await _(a=>a.querySelector(".erc-season-with-navigation"),document.getElementById("content"),!0),seasonSelectContainer:async()=>await _(a=>a.querySelector(".seasons-select"),document.getElementById("content"),!0)};async function ee(a){if(!a){p.unmount(R);return}const t=await q.seriesRatingContainer(),e=document.createElement("div");t.parentElement.insertBefore(e,t.nextSibling),p.mount(R,["assets/main-a8767f05.css"],e)}const U=/(E\d+)(?=\.|$)/;let E=[],L;async function te(a){if(L&&L.disconnect(),!a){if(!E)return;for(const[i,s,l]of E)console.log(s,l),i.innerHTML=i.innerHTML.replace(new RegExp(s,"gm"),l);return}E=[];let t=!1;const e=()=>{const i=document.querySelectorAll(".episode-list .card");let s=0;for(const[l,o]of i.entries()){let c=o.querySelector("h4 a").textContent;c=c.split("-")[0].trim();const f=U.exec(c);if(f===null){s++;continue}else(c.indexOf(".")!=-1||f[0]=="0")&&s++;const h=c.replace(U,`E${l+1-s}`);h!==c&&(t=!0,E.push([o,h,c]),o.innerHTML=o.innerHTML.replace(new RegExp(c,"gm"),h))}},n=await q.seasonWithNavigationContainer();L=new MutationObserver(()=>{if(t){t=!1;return}e()}),L.observe(n,{childList:!0,subtree:!0}),e()}let S;async function ie(a){if(p.unmount(M),!a.anilist&&!a.mal)return;S&&S.disconnect();const t=await q.seasonSelectContainer(),e=await _(i=>i.querySelector("h4"),t,!0),n=()=>{p.unmount(M);let i=e.innerText;i=i.replace(/^S\d+\s*[:-]\s*/,""),i=i.replace(/\([\w\s+-]+\)/,""),i=i.trim(),p.mount(M,["assets/main-a8767f05.css"],t,{seasonName:i,anilist:a.anilist,mal:a.mal})};S=new MutationObserver(()=>{n()}),S.observe(e,{characterData:!0,childList:!0,subtree:!0}),n()}async function ne(){const a=[y.NextEpisodeAirDate,y.RelativeEpisodeNumber,y.AnimeListLinks];V(a,(t,e)=>{switch(t){case y.NextEpisodeAirDate.key:ee(e);break;case y.RelativeEpisodeNumber.key:te(e);break;case y.AnimeListLinks.key:ie(e);break}},!0)}async function ae(){await ne()}function W(a){let t,e,n,i,s,l;return{c(){t=w("a"),e=u("svg"),n=u("path"),i=u("path"),s=u("path"),r(n,"fill","#1e2630"),r(n,"d","M0 0h1024v1024H0"),d(n,"stroke-width","2"),r(i,"fill","#02a9ff"),r(i,"d","M643.84 646.54V273.199c0-21.395-11.773-33.203-33.116-33.203h-72.865c-21.344 0-33.123 11.808-33.123 33.203v177.303c0 4.993 47.992 28.178 49.245 33.082 36.565 143.219 7.945 257.84-26.717 263.2 56.675 2.81 62.91 30.128 20.696 11.462 6.458-76.418 31.656-76.269 104.098-2.812.62.634 14.854 30.564 15.74 30.564h171.09c21.344 0 33.116-11.8 33.116-33.2v-73.048c0-21.396-11.772-33.203-33.116-33.203z"),d(i,"stroke-width","2"),r(s,"fill","#fefefe"),r(s,"d","M341.36 240 149.999 786h148.676l32.384-94.444h161.92L524.63 786h147.936L481.938 240Zm23.553 330.56 46.365-151.258 50.785 151.258z"),d(s,"stroke-width","2"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"width","20"),r(e,"height","20"),r(e,"viewBox","0 0 1024 1024"),r(e,"class","svelte-hz1k9i"),r(t,"href",l="https://anilist.co/anime/"+a[2]),r(t,"target","_blank"),r(t,"class","svelte-hz1k9i")},m(o,c){g(o,t,c),m(t,e),m(e,n),m(e,i),m(e,s)},p(o,c){c&4&&l!==(l="https://anilist.co/anime/"+o[2])&&r(t,"href",l)},d(o){o&&v(t)}}}function F(a){let t,e,n,i,s;return{c(){t=w("a"),e=u("svg"),n=u("path"),i=u("path"),r(n,"d","M0 0h1024v1024H0Z"),d(n,"fill","#2e51a2"),d(n,"stroke-width",".99968"),r(i,"d","M387.56 353.284v281.231l-70.21-.094v-174.1l-67.784 80.273-66.407-82.073-.673 176.464h-71.149V353.347h73.56l62.274 84.969 67.3-85zm288.07 69.083.83 211.522H597.5l-.265-95.862h-93.483c2.332 16.669 7.012 42.258 13.93 59.474 5.18 12.724 9.953 25.041 19.469 37.656l-56.922 37.562c-11.66-21.238-20.769-44.636-29.314-69.521a310.373 310.373 0 0 1-16.935-72.761c-2.833-25.042-3.24-49.113 3.569-73.857a130.481 130.481 0 0 1 38.767-62.306c10.455-9.782 25.041-16.7 36.733-22.944 11.69-6.245 24.806-8.812 36.967-11.989a247.284 247.284 0 0 1 39.769-6.104c13.287-1.142 36.967-2.206 79.82-.939l18.201 58.394H595.81c-19.798.266-29.314 0-44.777 6.98a74.655 74.655 0 0 0-42.664 64.169l88.913 1.095 1.267-60.428h77.097zm133.299-70.037v221.225l103.734 1.017-14.352 59.27h-160.5V351.281Z"),d(i,"fill","#fff"),d(i,"stroke-width","1.56459"),d(i,"stroke-dasharray","none"),r(e,"width","20"),r(e,"height","20"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"viewBox","0 0 1024 1024"),r(e,"class","svelte-hz1k9i"),r(t,"href",s="https://myanimelist.net/anime/"+a[3]),r(t,"target","_blank"),r(t,"class","svelte-hz1k9i")},m(l,o){g(l,t,o),m(t,e),m(e,n),m(e,i)},p(l,o){o&8&&s!==(s="https://myanimelist.net/anime/"+l[3])&&r(t,"href",s)},d(l){l&&v(t)}}}function se(a){let t,e,n=a[0]&&a[2]&&W(a),i=a[1]&&a[3]&&F(a);return{c(){t=w("div"),n&&n.c(),e=Z(),i&&i.c(),r(t,"class","svelte-hz1k9i")},m(s,l){g(s,t,l),n&&n.m(t,null),m(t,e),i&&i.m(t,null)},p(s,[l]){s[0]&&s[2]?n?n.p(s,l):(n=W(s),n.c(),n.m(t,e)):n&&(n.d(1),n=null),s[1]&&s[3]?i?i.p(s,l):(i=F(s),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:k,o:k,d(s){s&&v(t),n&&n.d(),i&&i.d()}}}function le(a,t,e){let{seasonName:n}=t,{anilist:i}=t,{mal:s}=t,l,o;return(async()=>{const c=`
		query {
			Media(search: "${n}", type: ANIME) {
				id
				idMal
			}
		}
		`,f=await T(c);e(2,l=f.data.Media.id),e(3,o=f.data.Media.idMal)})(),a.$$set=c=>{"seasonName"in c&&e(4,n=c.seasonName),"anilist"in c&&e(0,i=c.anilist),"mal"in c&&e(1,s=c.mal)},[i,s,l,o,n]}class A extends C{constructor(t){super(),I(this,t,le,se,H,{seasonName:4,anilist:0,mal:1})}}const G={headerContainer:async()=>await _(a=>a.querySelector(".current-media-header"),document.getElementById("content"),!0),episodeActionsContainer:async()=>await _(a=>a.querySelector(".episode-actions"),document.getElementById("content"),!0)};let N;async function re(a){if(p.unmount(A),!a.anilist&&!a.mal)return;N&&N.disconnect();const t=await G.headerContainer(),e=document.createElement("div");e.style.display="flex",e.style.alignItems="center",e.appendChild(t.lastChild),t.appendChild(e);const n=document.createElement("div");e.prepend(n);const i=async()=>{p.unmount(A);let l=(await G.headerContainer()).querySelector("h4").innerText;l=l.replace(/^S\d+\s*[:-]\s*/,""),l=l.replace(/\([\w\s+-]+\)/,""),l=l.trim(),p.mount(A,["assets/main-a8767f05.css"],n,{seasonName:l,anilist:a.anilist,mal:a.mal})};N=new MutationObserver(()=>{i()}),N.observe(t,{characterData:!0,childList:!0}),await i()}async function oe(){const a=[B.AnimeListLinks];V(a,(t,e)=>{switch(t){case B.AnimeListLinks.key:re(e);break}},!0)}async function ce(){await oe()}const me=[{entry:ae,pattern:/^https:\/\/www\.crunchyroll\.com(\/\w+)?\/series\/.*$/},{entry:ce,pattern:/^https:\/\/www\.crunchyroll\.com(\/\w+)?\/watch\/.*$/}];function x(){for(const{entry:a,pattern:t}of me)t.test(window.location.href)&&a()}function de(){let a=window.location.href;new MutationObserver(()=>{window.location.href!=a&&(x(),a=window.location.href)}).observe(document.body,{childList:!0,subtree:!0})}de();x();

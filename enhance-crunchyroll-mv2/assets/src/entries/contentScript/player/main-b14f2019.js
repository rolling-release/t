import{e as ie,g as ge,M as Ce}from"../../../../render-81cea469.js";import{J as Me,K as Pe,L as x,y as N,x as k,z as H,w as _,M as Ee,S as L,i as D,a as I,q as K,e as b,l as $,d as y,f as g,m as B,N as R,O as F,u as Q,r as X,v as G,g as C,P as J,t as Z,b as q,c as m,o as ne,n as E,Q as ae,F as le,R as S,h as ve,T as ce,U as be,A as V,B as z,V as ke,C as O,W as Se,E as we}from"../../../../index-16b32d61.js";import{b as re,a as Be,H as qe,c as Le,P as ee}from"../../../../settings-ec2c2194.js";import{e as se}from"../../../../each-e59479a4.js";import{m as De,s as Ie}from"../../../../utils-29e5526f.js";function je(l,e){const t=e.token={};function n(s,o,i,a){if(e.token!==t)return;e.resolved=a;let c=e.ctx;i!==void 0&&(c=c.slice(),c[i]=a);const r=s&&(e.current=s)(c);let u=!1;e.block&&(e.blocks?e.blocks.forEach((d,p)=>{p!==o&&d&&(N(),k(d,1,1,()=>{e.blocks[p]===d&&(e.blocks[p]=null)}),H())}):e.block.d(1),r.c(),_(r,1),r.m(e.mount(),e.anchor),u=!0),e.block=r,e.blocks&&(e.blocks[o]=r),u&&Ee()}if(Me(l)){const s=Pe();if(l.then(o=>{x(s),n(e.then,1,e.value,o),x(null)},o=>{if(x(s),n(e.catch,2,e.error,o),x(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,l),!0;e.resolved=l}}function Re(l,e,t){const n=e.slice(),{resolved:s}=l;l.current===l.then&&(n[l.value]=s),l.current===l.catch&&(n[l.error]=s),l.block.p(n,t)}function Fe(l){let e,t,n,s,o;const i=l[2].default,a=K(i,l,l[1],null);return{c(){e=b("button"),t=b("span"),a&&a.c(),$(t,"width","20px"),$(t,"height","20px"),$(t,"margin","auto"),$(e,"display","block"),$(e,"background","none"),$(e,"border","none"),$(e,"width","40px"),$(e,"height","40px"),$(e,"cursor","pointer")},m(c,r){y(c,e,r),g(e,t),a&&a.m(t,null),n=!0,s||(o=B(e,"click",R(F(l[3]))),s=!0)},p(c,[r]){a&&a.p&&(!n||r&2)&&Q(a,i,c,c[1],n?G(i,c[1],r,null):X(c[1]),null)},i(c){n||(_(a,c),n=!0)},o(c){k(a,c),n=!1},d(c){c&&C(e),a&&a.d(c),s=!1,o()}}}function Ve(l,e,t){let{$$slots:n={},$$scope:s}=e,o=J();const i=()=>o("click");return l.$$set=a=>{"$$scope"in a&&t(1,s=a.$$scope)},[o,s,n,i]}class ze extends L{constructor(e){super(),D(this,e,Ve,Fe,I,{})}}function Oe(l){let e,t,n,s,o,i,a,c,r,u,d;return{c(){e=b("div"),t=b("div"),n=Z(l[0]),s=q(),o=b("div"),i=b("span"),a=Z(l[1]),c=q(),r=b("span"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#FFF" fill-rule="evenodd" d="M8.6 7.4L10 6l6 6-6 6-1.4-1.4 4.6-4.6z"></path></svg>',m(t,"class","popup-menu-item-name svelte-1kc86fo"),$(r,"width","24px"),$(r,"height","24px"),m(o,"class","popup-menu-item-value svelte-1kc86fo"),m(e,"class","popup-menu-item svelte-1kc86fo"),m(e,"tabindex","0"),m(e,"role","button")},m(p,f){y(p,e,f),g(e,t),g(t,n),g(e,s),g(e,o),g(o,i),g(i,a),g(o,c),g(o,r),u||(d=[B(e,"click",R(F(l[3]))),B(e,"keydown",R(F(ie)))],u=!0)},p(p,[f]){f&1&&ne(n,p[0]),f&2&&ne(a,p[1])},i:E,o:E,d(p){p&&C(e),u=!1,ae(d)}}}function Ae(l,e,t){let{name:n}=e,{value:s}=e;const o=J(),i=()=>o("click");return l.$$set=a=>{"name"in a&&t(0,n=a.name),"value"in a&&t(1,s=a.value)},[n,s,o,i]}class Te extends L{constructor(e){super(),D(this,e,Ae,Oe,I,{name:0,value:1})}}function Ne(l){let e,t,n;return{c(){e=S("svg"),t=S("circle"),n=S("path"),$(t,"fill","rgb(25, 46, 56)"),$(t,"opacity","1"),m(t,"class","bg"),m(t,"cx","10"),m(t,"cy","10"),m(t,"r","9"),m(n,"class","outer_circle svelte-1txnuqp"),m(n,"d","M10,2a8,8,0,1,1-8,8,8.009,8.009,0,0,1,8-8m0-2A10,10,0,1,0,20,10,10,10,0,0,0,10,0Z"),m(e,"xmlns","http://www.w3.org/2000/svg"),$(e,"margin-right","8px"),$(e,"height","20px"),$(e,"width","20px"),m(e,"viewBox","0 0 20 20")},m(s,o){y(s,e,o),g(e,t),g(e,n)},d(s){s&&C(e)}}}function He(l){let e,t,n,s;return{c(){e=S("svg"),t=S("circle"),n=S("circle"),s=S("path"),$(t,"fill","rgb(25, 46, 56)"),$(t,"opacity","1"),m(t,"class","bg"),m(t,"cx","10"),m(t,"cy","10"),m(t,"r","9"),$(n,"fill","rgb(68, 195, 171)"),m(n,"class","dot"),m(n,"cx","10"),m(n,"cy","10"),m(n,"r","4"),$(s,"fill","rgb(68, 195, 171)"),m(s,"class","outer_circle svelte-1txnuqp"),m(s,"d","M10,2a8,8,0,1,1-8,8,8.009,8.009,0,0,1,8-8m0-2A10,10,0,1,0,20,10,10,10,0,0,0,10,0Z"),m(e,"xmlns","http://www.w3.org/2000/svg"),$(e,"margin-right","8px"),$(e,"height","20px"),$(e,"width","20px"),m(e,"viewBox","0 0 20 20")},m(o,i){y(o,e,i),g(e,t),g(e,n),g(e,s)},d(o){o&&C(e)}}}function Je(l){let e,t,n,s,o,i,a;function c(f,P){return f[0]===f[1]?He:Ne}let r=c(l),u=r(l);const d=l[4].default,p=K(d,l,l[3],null);return{c(){e=b("div"),t=b("div"),u.c(),n=q(),s=b("div"),p&&p.c(),m(t,"class","popup-menu-select-item-icon svelte-1txnuqp"),m(s,"class","popup-menu-select-item-content svelte-1txnuqp"),m(e,"class","popup-menu-select-item svelte-1txnuqp"),m(e,"role","button"),m(e,"tabindex","0"),le(e,"active",l[0]===l[1])},m(f,P){y(f,e,P),g(e,t),u.m(t,null),g(e,n),g(e,s),p&&p.m(s,null),o=!0,i||(a=[B(e,"click",R(F(l[5]))),B(e,"keydown",R(F(ie)))],i=!0)},p(f,[P]){r!==(r=c(f))&&(u.d(1),u=r(f),u&&(u.c(),u.m(t,null))),p&&p.p&&(!o||P&8)&&Q(p,d,f,f[3],o?G(d,f[3],P,null):X(f[3]),null),(!o||P&3)&&le(e,"active",f[0]===f[1])},i(f){o||(_(p,f),o=!0)},o(f){k(p,f),o=!1},d(f){f&&C(e),u.d(),p&&p.d(f),i=!1,ae(a)}}}function Ue(l,e,t){let{$$slots:n={},$$scope:s}=e,{value:o}=e,{activeValue:i}=e;const a=J(),c=()=>{t(0,i=o),a("click",{value:o})};return l.$$set=r=>{"value"in r&&t(1,o=r.value),"activeValue"in r&&t(0,i=r.activeValue),"$$scope"in r&&t(3,s=r.$$scope)},[i,o,a,s,n,c]}class We extends L{constructor(e){super(),D(this,e,Ue,Je,I,{value:1,activeValue:0})}}function ue(l,e,t){const n=l.slice();return n[7]=e[t],n}function Ze(l){let e=l[7].name+"",t,n;return{c(){t=Z(e),n=q()},m(s,o){y(s,t,o),y(s,n,o)},p(s,o){o&4&&e!==(e=s[7].name+"")&&ne(t,e)},d(s){s&&(C(t),C(n))}}}function fe(l){let e,t,n;function s(i){l[5](i)}let o={value:l[7].value,$$slots:{default:[Ze]},$$scope:{ctx:l}};return l[0]!==void 0&&(o.activeValue=l[0]),e=new We({props:o}),ce.push(()=>be(e,"activeValue",s)),e.$on("click",l[6]),{c(){V(e.$$.fragment)},m(i,a){z(e,i,a),n=!0},p(i,a){const c={};a&4&&(c.value=i[7].value),a&1028&&(c.$$scope={dirty:a,ctx:i}),!t&&a&1&&(t=!0,c.activeValue=i[0],ke(()=>t=!1)),e.$set(c)},i(i){n||(_(e.$$.fragment,i),n=!0)},o(i){k(e.$$.fragment,i),n=!1},d(i){O(e,i)}}}function Ke(l){let e,t,n,s,o,i,a,c,r,u,d,p=se(l[2]),f=[];for(let h=0;h<p.length;h+=1)f[h]=fe(ue(l,p,h));const P=h=>k(f[h],1,1,()=>{f[h]=null});return{c(){e=b("div"),t=S("svg"),n=S("path"),s=q(),o=b("div"),i=Z(l[1]),a=q(),c=b("div");for(let h=0;h<f.length;h+=1)f[h].c();m(n,"fill","#FFF"),m(n,"fill-rule","evenodd"),m(n,"d","M15.4 16.6L14 18l-6-6 6-6 1.4 1.4-4.6 4.6z"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"viewBox","0 0 24 24"),m(t,"class","svelte-8nhtd1"),m(o,"class","svelte-8nhtd1"),m(e,"class","popup-menu-select-head svelte-8nhtd1"),m(e,"role","button"),m(e,"tabindex","0")},m(h,M){y(h,e,M),g(e,t),g(t,n),g(e,s),g(e,o),g(o,i),y(h,a,M),y(h,c,M);for(let w=0;w<f.length;w+=1)f[w]&&f[w].m(c,null);r=!0,u||(d=[B(e,"click",R(F(l[4]))),B(e,"keydown",R(F(ie)))],u=!0)},p(h,[M]){if((!r||M&2)&&ne(i,h[1]),M&13){p=se(h[2]);let w;for(w=0;w<p.length;w+=1){const A=ue(h,p,w);f[w]?(f[w].p(A,M),_(f[w],1)):(f[w]=fe(A),f[w].c(),_(f[w],1),f[w].m(c,null))}for(N(),w=p.length;w<f.length;w+=1)P(w);H()}},i(h){if(!r){for(let M=0;M<p.length;M+=1)_(f[M]);r=!0}},o(h){f=f.filter(Boolean);for(let M=0;M<f.length;M+=1)k(f[M]);r=!1},d(h){h&&(C(e),C(a),C(c)),ve(f,h),u=!1,ae(d)}}}function Qe(l,e,t){let{name:n}=e,{items:s}=e,{value:o}=e;const i=J(),a=()=>i("close");function c(u){o=u,t(0,o)}const r=u=>i("click",u.detail);return l.$$set=u=>{"name"in u&&t(1,n=u.name),"items"in u&&t(2,s=u.items),"value"in u&&t(0,o=u.value)},[o,n,s,i,a,c,r]}class Xe extends L{constructor(e){super(),D(this,e,Qe,Ke,I,{name:1,items:2,value:0})}}function Ge(l){let e;return{c(){e=b("div"),m(e,"class","svelte-uo1oha")},m(t,n){y(t,e,n)},p:E,i:E,o:E,d(t){t&&C(e)}}}class Ye extends L{constructor(e){super(),D(this,e,null,Ge,I,{})}}const xe=l=>({}),me=l=>({});function pe(l,e,t){const n=l.slice();return n[22]=e[t],n}function de(l){let e,t,n={ctx:l,current:null,token:null,hasCatch:!0,pending:st,then:tt,catch:et,value:21,error:25,blocks:[,,,]};return je(l[3](),n),{c(){e=b("div"),n.block.c(),m(e,"class","popup svelte-q29kxh")},m(s,o){y(s,e,o),n.block.m(e,n.anchor=null),n.mount=()=>e,n.anchor=null,t=!0},p(s,o){l=s,Re(n,l,o)},i(s){t||(_(n.block),t=!0)},o(s){for(let o=0;o<3;o+=1){const i=n.blocks[o];k(i)}t=!1},d(s){s&&C(e),n.block.d(),n.token=null,n=null}}}function et(l){let e,t;return{c(){e=b("div"),t=b("p"),t.textContent=`${l[25]}`,m(e,"class","error svelte-q29kxh")},m(n,s){y(n,e,s),g(e,t)},p:E,i:E,o:E,d(n){n&&C(e)}}}function tt(l){let e,t,n,s;const o=[lt,nt],i=[];function a(c,r){return c[1]!==null?0:1}return e=a(l),t=i[e]=o[e](l),{c(){t.c(),n=we()},m(c,r){i[e].m(c,r),y(c,n,r),s=!0},p(c,r){let u=e;e=a(c),e===u?i[e].p(c,r):(N(),k(i[u],1,1,()=>{i[u]=null}),H(),t=i[e],t?t.p(c,r):(t=i[e]=o[e](c),t.c()),_(t,1),t.m(n.parentNode,n))},i(c){s||(_(t),s=!0)},o(c){k(t),s=!1},d(c){c&&C(n),i[e].d(c)}}}function nt(l){let e,t,n,s=se(l[21]),o=[];for(let c=0;c<s.length;c+=1)o[c]=_e(pe(l,s,c));const i=c=>k(o[c],1,1,()=>{o[c]=null});let a=l[6].default&&he(l);return{c(){for(let c=0;c<o.length;c+=1)o[c].c();e=q(),a&&a.c(),t=we()},m(c,r){for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(c,r);y(c,e,r),a&&a.m(c,r),y(c,t,r),n=!0},p(c,r){if(r&10){s=se(c[21]);let u;for(u=0;u<s.length;u+=1){const d=pe(c,s,u);o[u]?(o[u].p(d,r),_(o[u],1)):(o[u]=_e(d),o[u].c(),_(o[u],1),o[u].m(e.parentNode,e))}for(N(),u=s.length;u<o.length;u+=1)i(u);H()}c[6].default?a?(a.p(c,r),r&64&&_(a,1)):(a=he(c),a.c(),_(a,1),a.m(t.parentNode,t)):a&&(N(),k(a,1,1,()=>{a=null}),H())},i(c){if(!n){for(let r=0;r<s.length;r+=1)_(o[r]);_(a),n=!0}},o(c){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)k(o[r]);k(a),n=!1},d(c){c&&(C(e),C(t)),ve(o,c),a&&a.d(c)}}}function lt(l){let e,t,n;function s(a){l[9](a)}function o(){return l[10](l[21])}let i={name:l[1].name,items:l[1].items};return l[1].value!==void 0&&(i.value=l[1].value),e=new Xe({props:i}),ce.push(()=>be(e,"value",s)),e.$on("click",o),e.$on("close",l[11]),{c(){V(e.$$.fragment)},m(a,c){z(e,a,c),n=!0},p(a,c){l=a;const r={};c&2&&(r.name=l[1].name),c&2&&(r.items=l[1].items),!t&&c&2&&(t=!0,r.value=l[1].value,ke(()=>t=!1)),e.$set(r)},i(a){n||(_(e.$$.fragment,a),n=!0)},o(a){k(e.$$.fragment,a),n=!1},d(a){O(e,a)}}}function _e(l){var o;let e,t;function n(...i){return l[12](l[22],...i)}function s(){return l[13](l[22])}return e=new Te({props:{name:l[22].name,value:((o=l[22].items.find(n))==null?void 0:o.name)||"n/a"}}),e.$on("click",s),{c(){V(e.$$.fragment)},m(i,a){z(e,i,a),t=!0},p(i,a){l=i},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){k(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function he(l){let e,t;const n=l[8].default,s=K(n,l,l[16],null);return{c(){e=b("div"),s&&s.c(),m(e,"class","extra-content svelte-q29kxh")},m(o,i){y(o,e,i),s&&s.m(e,null),t=!0},p(o,i){s&&s.p&&(!t||i&65536)&&Q(s,n,o,o[16],t?G(n,o[16],i,null):X(o[16]),null)},i(o){t||(_(s,o),t=!0)},o(o){k(s,o),t=!1},d(o){o&&C(e),s&&s.d(o)}}}function st(l){let e,t,n,s;return n=new Ye({}),{c(){e=b("span"),t=b("span"),V(n.$$.fragment),m(t,"class","svelte-q29kxh"),m(e,"class","loading svelte-q29kxh")},m(o,i){y(o,e,i),g(e,t),z(n,t,null),s=!0},p:E,i(o){s||(_(n.$$.fragment,o),s=!0)},o(o){k(n.$$.fragment,o),s=!1},d(o){o&&C(e),O(n)}}}function ot(l){let e;const t=l[8].button,n=K(t,l,l[16],me);return{c(){n&&n.c()},m(s,o){n&&n.m(s,o),e=!0},p(s,o){n&&n.p&&(!e||o&65536)&&Q(n,t,s,s[16],e?G(t,s[16],o,xe):X(s[16]),me)},i(s){e||(_(n,s),e=!0)},o(s){k(n,s),e=!1},d(s){n&&n.d(s)}}}function it(l){let e,t,n,s,o,i=l[0]&&de(l);return s=new ze({props:{$$slots:{default:[ot]},$$scope:{ctx:l}}}),s.$on("click",l[14]),{c(){e=b("div"),i&&i.c(),t=q(),n=b("div"),V(s.$$.fragment),m(n,"class","button svelte-q29kxh"),le(n,"active",l[0])},m(a,c){y(a,e,c),i&&i.m(e,null),g(e,t),g(e,n),z(s,n,null),l[15](e),o=!0},p(a,[c]){a[0]?i?(i.p(a,c),c&1&&_(i,1)):(i=de(a),i.c(),_(i,1),i.m(e,t)):i&&(N(),k(i,1,1,()=>{i=null}),H());const r={};c&65536&&(r.$$scope={dirty:c,ctx:a}),s.$set(r),(!o||c&1)&&le(n,"active",a[0])},i(a){o||(_(i),_(s.$$.fragment,a),o=!0)},o(a){k(i),k(s.$$.fragment,a),o=!1},d(a){a&&C(e),i&&i.d(),O(s),l[15](null)}}}function at(l,e,t){let{$$slots:n={},$$scope:s}=e;const o=Se(n);let{itemsFn:i}=e;const a=async()=>{try{const v=await i();return M(v),v}catch(v){throw console.error(v),v}};let c=null,r=!1,u,d,p;function f(){d=document.getElementById("settingsControl").firstElementChild.firstElementChild.firstElementChild,d.click(),d.style.backgroundColor="";const T=document.getElementById("vilosControlsContainer");ge(()=>document.getElementById("velocity-settings-menu"),T).then(Y=>Y.style.display="none"),p=new AbortController,document.addEventListener("click",Y=>{!Y.target.contains(u)&&!u.contains(Y.target)&&P()},{signal:p.signal})}function P(){p.abort(),d.click(),t(0,r=!1)}const h=J();function M(v){h("change",v.map(T=>({id:T.id,value:T.value})))}function w(v){l.$$.not_equal(c.value,v)&&(c.value=v,t(1,c))}const A=v=>{M(v),t(1,c=null)},U=()=>t(1,c=null),j=(v,T)=>T.value===v.value,oe=v=>t(1,c=v),$e=()=>r?P():t(0,r=!0);function ye(v){ce[v?"unshift":"push"](()=>{u=v,t(2,u)})}return l.$$set=v=>{"itemsFn"in v&&t(7,i=v.itemsFn),"$$scope"in v&&t(16,s=v.$$scope)},l.$$.update=()=>{l.$$.dirty&1&&r&&f()},[r,c,u,a,P,M,o,i,n,w,A,U,j,oe,$e,ye,s]}class ct extends L{constructor(e){super(),D(this,e,at,it,I,{itemsFn:7})}}function rt(l){let e,t,n,s;const o=l[2].default,i=K(o,l,l[1],null);return{c(){e=b("button"),i&&i.c(),m(e,"class","svelte-84rm8b")},m(a,c){y(a,e,c),i&&i.m(e,null),t=!0,n||(s=B(e,"click",l[3]),n=!0)},p(a,[c]){i&&i.p&&(!t||c&2)&&Q(i,o,a,a[1],t?G(o,a[1],c,null):X(a[1]),null)},i(a){t||(_(i,a),t=!0)},o(a){k(i,a),t=!1},d(a){a&&C(e),i&&i.d(a),n=!1,s()}}}function ut(l,e,t){let{$$slots:n={},$$scope:s}=e;const o=J(),i=a=>o("click",a);return l.$$set=a=>{"$$scope"in a&&t(1,s=a.$$scope)},[o,s,n,i]}class ft extends L{constructor(e){super(),D(this,e,ut,rt,I,{})}}async function mt(){let l=(await re.storage.local.get("jwt")).jwt;return(l===void 0||pt(l).getTime()-5e3<Date.now())&&(l=(await(await fetch("https://www.crunchyroll.com/auth/v1/token",{method:"POST",headers:{Authorization:"Basic bm9haWhkZXZtXzZpeWcwYThsMHE6","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"etp_rt_cookie"}),credentials:"include"})).json()).access_token,await re.storage.local.set({jwt:l})),l}function pt(l){const e=JSON.parse(atob(l.split(".")[1]));return new Date(e.exp*1e3)}function dt(l){let e;return{c(){e=Z("Download")},m(t,n){y(t,e,n)},d(t){t&&C(e)}}}function _t(l){let e,t,n;return t=new ft({props:{$$slots:{default:[dt]},$$scope:{ctx:l}}}),t.$on("click",l[2]),{c(){e=b("div"),V(t.$$.fragment),m(e,"class","download-button svelte-1uldpsl")},m(s,o){y(s,e,o),z(t,e,null),n=!0},p(s,o){const i={};o&256&&(i.$$scope={dirty:o,ctx:s}),t.$set(i)},i(s){n||(_(t.$$.fragment,s),n=!0)},o(s){k(t.$$.fragment,s),n=!1},d(s){s&&C(e),O(t)}}}function ht(l){let e;return{c(){e=b("div"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20" style="filter: invert(1)"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg>',m(e,"slot","button")},m(t,n){y(t,e,n)},p:E,d(t){t&&C(e)}}}function gt(l){let e,t;return e=new ct({props:{itemsFn:l[1],$$slots:{button:[ht],default:[_t]},$$scope:{ctx:l}}}),e.$on("change",l[3]),{c(){V(e.$$.fragment)},m(n,s){z(e,n,s),t=!0},p(n,[s]){const o={};s&256&&(o.$$scope={dirty:s,ctx:n}),e.$set(o)},i(n){t||(_(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function vt(l,e,t){let n,s=null,o=null,i={};async function a(){const d=await c();return[{id:"quality",name:"Quality",items:d.map(p=>({name:`${p.height}p`,value:p})),value:d[0]}]}async function c(){if(s==null||o==null){const d=await mt();if(n==null&&(n=await(await fetch("https://www.crunchyroll.com/index/v2",{headers:{Authorization:`Bearer ${d}`}})).json()),s==null&&(s=(await(await fetch(`https://www.crunchyroll.com/content/v2/cms/objects/${W}`,{headers:{Authorization:`Bearer ${d}`}})).json()).data[0]),o==null){const p=n.cms_web.bucket,f=/\/(\w+)\/streams/.exec(s.streams_link)[1],P=new URLSearchParams({Signature:n.cms_web.signature,Policy:n.cms_web.policy,"Key-Pair-Id":n.cms_web.key_pair_id}),M=await(await fetch(`https://www.crunchyroll.com/cms/v2${p}/videos/${f}/streams?${P}`,{headers:{Authorization:`Bearer ${d}`}})).json(),A=await(await fetch(M.streams.adaptive_hls[""].url)).text(),U=new De.Parser;U.push(A),U.end(),o=U.manifest.playlists.map(j=>({width:j.attributes.RESOLUTION.width,height:j.attributes.RESOLUTION.height,url:j.uri})).sort((j,oe)=>oe.height-j.height)}}return t(0,i.id=W,i),t(0,i.title=s.title,i),t(0,i.sources=o.reduce((d,p)=>Object.assign(Object.assign({},d),{[p.height]:p.url}),{}),i),t(0,i.options={quality:{width:0,height:0}},i),o.map(d=>({width:d.width,height:d.height}))}async function r(){await Be(qe,{id:W,title:s.title,thumbnail:s.images.thumbnail[0][0].source,url:i.sources[i.options.quality.height],filename:`${i.title}.ts`})}return[i,a,r,d=>t(0,i.options=d.detail.reduce((p,f)=>({...p,[f.id]:f.value}),{}),i)]}class bt extends L{constructor(e){super(),D(this,e,vt,gt,I,{})}}async function kt(){const l=()=>{document.querySelector("#settingsControl").nextElementSibling.click()},e=n=>n.stopImmediatePropagation(),t=[ee.DoubleClickMaximize,ee.DefaultContextMenu];Le(t,(n,s)=>{switch(n){case ee.DoubleClickMaximize.key:{s?window.addEventListener("dblclick",l):window.removeEventListener("dblclick",l);break}case ee.DefaultContextMenu.key:{s?document.addEventListener("contextmenu",e,!0):document.removeEventListener("contextmenu",e,!0);break}}},!0)}let W="",te;async function wt(l){var s,o;const e=JSON.parse(l.data);if(e.method!="extendConfig"||W===((o=(s=e.value)==null?void 0:s.media)==null?void 0:o.metadata.id))return;W=e.value.media.metadata.id,te&&te.disconnect();const t=document.getElementById("vilos");await Ie(100);const n=await ge(i=>i.querySelector("#vilosControlsContainer"),t,!0);te=new MutationObserver(async()=>{const i=n.querySelector("#settingsControl");if(i==null)return;const a=i.parentElement.parentElement,[c,r]=a.children;Ce.mount(bt,["assets/main-875a1562.css"],c)}),te.observe(n,{childList:!0})}async function $t(){window.addEventListener("message",wt)}$t();kt();
